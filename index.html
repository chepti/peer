<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <!-- הוספת תלות ב-Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <!-- הוספת אייקונים של Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  
  <?!= include('styles'); ?>
</head>
<body>

  <!-- Main container -->
  <div class="container-fluid p-0">
    
    <!-- Header -->
    <header class="p-3 d-flex justify-content-between align-items-center">
      <h1 class="h4 m-0">פלטפורמת ביקורת עמיתים</h1>
      <div id="user-controls">
        <!-- יוצג למשתמשים לא מחוברים -->
        <div id="guest-view">
          <button class="btn btn-outline-primary" onclick="showLoginScreen()">התחברות</button>
          <button class="btn btn-primary" onclick="showRegisterScreen()">הרשמה</button>
        </div>
        <!-- יוצג למשתמשים מחוברים -->
        <div id="user-view" class="d-none align-items-center">
           <span id="welcome-message" class="me-3"></span>
           <button class="btn btn-danger" onclick="logout()">התנתקות</button>
        </div>
      </div>
    </header>

    <!-- Login Screen -->
    <div id="login-screen" class="d-none vh-100 d-flex justify-content-center align-items-center">
        <div class="auth-form">
            <h2>התחברות</h2>
            <input type="text" id="login-username" class="form-control mb-2" placeholder="שם משתמש">
            <input type="password" id="login-password" class="form-control mb-2" placeholder="סיסמה">
            <button class="btn btn-primary w-100" onclick="handleLogin()">התחבר</button>
            <p class="mt-2 text-center">אין לך חשבון? <a href="#" onclick="showRegisterScreen()">הירשם כאן</a></p>
        </div>
    </div>
    
    <!-- Registration Screen -->
    <div id="register-screen" class="d-none vh-100 d-flex justify-content-center align-items-center">
        <div class="auth-form">
            <h2>הרשמה</h2>
            <input type="text" id="register-username" class="form-control mb-2" placeholder="שם משתמש">
            <input type="password" id="register-password" class="form-control mb-2" placeholder="סיסמה">
            <input type="text" id="register-fullname" class="form-control mb-2" placeholder="שם מלא">
            <input type="text" id="register-question" class="form-control mb-2" placeholder="שאלת אימות (לשחזור סיסמה)">
            <input type="text" id="register-answer" class="form-control mb-2" placeholder="תשובה לשאלת האימות">
            <button class="btn btn-primary w-100" onclick="handleRegister()">הירשם</button>
            <p class="mt-2 text-center">יש לך כבר חשבון? <a href="#" onclick="showLoginScreen()">התחבר כאן</a></p>
        </div>
    </div>
    
    <!-- App Content (Initially hidden) -->
    <div id="app-content" class="d-none">
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="gallery-tab" data-bs-toggle="tab" data-bs-target="#gallery" type="button" role="tab" aria-controls="gallery" aria-selected="true">גלריה</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="submissions-tab" data-bs-toggle="tab" data-bs-target="#submissions" type="button" role="tab" aria-controls="submissions" aria-selected="false">ההגשות שלי</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab" aria-controls="reviews" aria-selected="false">הביקורות שלי</button>
        </li>
      </ul>
      <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="gallery" role="tabpanel" aria-labelledby="gallery-tab">
           <div id="gallery-content" class="row p-3"></div>
        </div>
        <div class="tab-pane fade" id="submissions" role="tabpanel" aria-labelledby="submissions-tab">
          <div class="p-3">
            <button id="add-submission-btn" class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#submissionModal"><i class="bi bi-plus-circle"></i> הוסף הגשה חדשה</button>
            <div id="my-submissions-content" class="row"></div>
          </div>
        </div>
        <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
           <div id="my-reviews-content" class="p-3"></div>
        </div>
      </div>
    </div>

    <!-- Submission Modal -->
    <div class="modal fade" id="submissionModal" tabindex="-1" aria-labelledby="submissionModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="submissionModalLabel">הגשת תוצר חדש</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="submissionForm">
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="title" class="form-label">כותרת התוצר</label>
                  <input type="text" id="title" class="form-control" required>
                </div>
                <div class="col-md-6">
                  <label for="toolUsed" class="form-label">באיזה כלי השתמשת?</label>
                  <input type="text" id="toolUsed" class="form-control" required placeholder="למשל: Canva, Genially">
                </div>
                <div class="col-12">
                  <label for="instructions" class="form-label">הוראות שימוש / תיאור קצר</label>
                  <textarea id="instructions" class="form-control" rows="3" required></textarea>
                </div>
                <div class="col-md-6">
                  <label for="targetAudience" class="form-label">קהל יעד</label>
                  <input type="text" id="targetAudience" class="form-control" placeholder="למשל: כיתות א-ב, מורים">
                </div>
                <div class="col-md-6">
                  <label for="tags" class="form-label">תגיות (מופרדות בפסיק)</label>
                  <input type="text" id="tags" class="form-control" placeholder="למשל: שפה, חשבון, חגים">
                </div>
                <div class="col-md-6">
                    <label for="artifactType" class="form-label">סוג התוצר</label>
                    <select id="artifactType" class="form-select">
                      <option value="link" selected>קישור (ל-Canva, Genially וכו')</option>
                      <option value="image">קובץ תמונה (jpg, png, gif)</option>
                      <option value="pdf">קובץ PDF</option>
                    </select>
                </div>
                <div class="col-md-6" id="link-group">
                    <label for="artifactLink" class="form-label">קישור לתוצר</label>
                    <input type="url" id="artifactLink" class="form-control" placeholder="https://...">
                </div>
                <div class="col-12">
                  <label class="form-label">תמונה מייצגת (חובה)</label>
                   <div id="paste-area-image" class="paste-area">
                       <p id="paste-area-text">גרור תמונה לכאן, לחץ לבחירה, או הדבק (Ctrl+V)</p>
                       <input type="file" id="previewImageInput" class="d-none" accept="image/*">
                       <img id="image-preview" style="display: none;" alt="תצוגה מקדימה">
                   </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ביטול</button>
            <button type="submit" form="submissionForm" class="btn btn-primary">הגשת תוצר</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Review Modal -->
    <div class="modal fade" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="reviewModalLabel">מתן ביקורת</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>כאן יוצג התוצר לביקורת, ולאחר מכן טופס למילוי משוב.</p>
            <!-- Review form will be built out here -->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">סגירה</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Loader -->
    <div id="loader" class="d-none">
        <div class="spinner"></div>
    </div>

    <!-- Toast container -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">הודעה</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toast-body">
            </div>
        </div>
    </div>
  </div> <!-- end of container-fluid -->

  <!-- הוספת תלות ב-Bootstrap JS Bundle (כולל Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  
  <?!= include('javascript'); ?>

</body>
</html> 